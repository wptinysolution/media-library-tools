<?php
// Add a custom shortcode for retrieving images from the upload directory and its subdirectories
add_shortcode('all_images', 'retrieve_all_images');

function retrieve_all_images() {
    // Get the upload directory path
    $uploadDir = wp_upload_dir()['basedir'];

    // Create an array to store the image URLs
    $imageUrls = array();

    // Recursive function to scan directories
    function scan_directories($directory) {
        $images = glob("$directory/*.{jpg,jpeg,png,gif}", GLOB_BRACE);
        foreach ($images as $image) {
            $imageUrl = str_replace(wp_upload_dir()['basedir'], wp_upload_dir()['baseurl'], $image);
            $imageUrls[] = $imageUrl;
        }

        $directories = glob("$directory/*", GLOB_ONLYDIR);
        foreach ($directories as $subdirectory) {
            scan_directories($subdirectory);
        }
    }

    // Scan the upload directory and its subdirectories for image files
    scan_directories($uploadDir);

    // Output the image URLs
    if (!empty($imageUrls)) {
        $output = '<ul>';
        foreach ($imageUrls as $imageUrl) {
            $output .= '<li><img src="' . $imageUrl . '"></li>';
        }
        $output .= '</ul>';
    } else {
        $output = 'No images found.';
    }

    return $output;
}
